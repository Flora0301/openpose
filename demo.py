#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Tue Apr 28 19:17:47 2020

@author: joe
"""


from src import torch_openpose,util
import os
import cv2

if __name__ == "__main__":
    tp = torch_openpose.torch_openpose('body_25')

    img = cv2.imread("images/216/159.jpg")
    # img_resize = img[5:631, 3:1120]
    image = img.copy()

    print("H: " + str(img.shape[0]))
    print("W: " + str(img.shape[1]))

    poses, heels, heel, position = tp(img)
    print("heels: " + str(heels))
    print("heel: " + str(heel))

    img = util.draw_bodypose(img, poses,'body_25')
    image = util.draw_bodypose(image, position, 'body_25')

    # cv2.imshow('v',img)
    cv2.imshow('simple', image)

    filenum = 216
    num = 159
    # 存储包含关键点的图片
    file = './pos_image/{0:03d}/'.format(filenum)
    fileName = './pos_image/{0:03d}/'.format(filenum) + str(num) + '.jpg'  # 存储路径
    fileName_simple = './pos_image/{0:03d}/'.format(filenum) + str(num) + '(1)' + '.jpg'  # 存储路径
    # print("filename = " + fileName)
    # 判断路径是否存在，若不存在则创建
    if not os.path.exists(file):
        os.makedirs(file)

    cv2.imwrite(fileName, img, [cv2.IMWRITE_JPEG_QUALITY, 100])
    cv2.imwrite(fileName_simple, image, [cv2.IMWRITE_JPEG_QUALITY, 100])

    cv2.waitKey(0)
    cv2.destroyAllWindows()

# position: [[[973.0, 398.0, 0.8620839715003967]], [[923.0, 363.0, 0.915093183517456]], [[939.0, 384.0, 0.9048148989677429]], [[929.0, 485.0, 0.9386486411094666]], [[970.0, 576.0, 0.9365293383598328]], [[910.0, 347.0, 0.807531476020813]], [[0.0, 0.0, 0.0]], [[0.0, 0.0, 0.0]], [[785.0, 447.0, 0.8518484830856323]], [[799.0, 451.0, 0.7973741888999939]], [[927.0, 481.0, 0.8692925572395325]], [[890.0, 579.0, 0.9416757225990295]], [[768.0, 441.0, 0.7957040667533875]], [[889.0, 460.0, 0.7222833633422852]], [[845.0, 544.0, 0.88592529296875]], [[983.0, 389.0, 0.8679874539375305]], [[0.0, 0.0, 0.0]], [[979.0, 366.0, 0.9168338179588318]], [[0.0, 0.0, 0.0]], [[887.0, 555.0, 0.28716394305229187]], [[880.0, 547.0, 0.23058128356933594]], [[834.0, 549.0, 0.8191089034080505]], [[929.0, 597.0, 0.7750983238220215]], [[921.0, 602.0, 0.7987850904464722]], [[873.0, 584.0, 0.8941373825073242]]]
# pose:[[[698.0, 198.0, 0.9409115314483643], [696.0, 225.0, 0.9633354544639587], [670.0, 224.0, 0.9472788572311401], [654.0, 260.0, 0.8867952823638916], [671.0, 235.0, 0.800603449344635], [721.0, 227.0, 0.9356898069381714], [734.0, 264.0, 0.9468590617179871], [721.0, 264.0, 0.843252420425415], [692.0, 300.0, 0.9548803567886353], [673.0, 299.0, 1.0017368793487549], [670.0, 358.0, 0.9563668966293335], [666.0, 413.0, 0.9561580419540405], [707.0, 300.0, 0.9880707859992981], [710.0, 362.0, 0.9736611843109131], [712.0, 422.0, 0.9863848686218262], [692.0, 191.0, 0.9191923141479492], [703.0, 193.0, 0.9500170946121216], [680.0, 193.0, 0.8083977103233337], [709.0, 196.0, 0.7769453525543213], [702.0, 428.0, 0.7233798503875732], [710.0, 429.0, 0.7836205959320068], [714.0, 426.0, 0.8952617049217224], [659.0, 424.0, 0.9291034936904907], [650.0, 420.0, 0.9631871581077576], [669.0, 416.0, 0.9162793755531311]],
#       [[973.0, 398.0, 0.8620839715003967], [923.0, 363.0, 0.915093183517456], [939.0, 384.0, 0.9048148989677429], [929.0, 485.0, 0.9386486411094666], [970.0, 576.0, 0.9365293383598328], [910.0, 347.0, 0.807531476020813], [0.0, 0.0, 0.0], [0.0, 0.0, 0.0], [785.0, 447.0, 0.8518484830856323], [799.0, 451.0, 0.7973741888999939], [927.0, 481.0, 0.8692925572395325], [890.0, 579.0, 0.9416757225990295], [768.0, 441.0, 0.7957040667533875], [889.0, 460.0, 0.7222833633422852], [845.0, 544.0, 0.88592529296875], [983.0, 389.0, 0.8679874539375305], [0.0, 0.0, 0.0], [979.0, 366.0, 0.9168338179588318], [0.0, 0.0, 0.0], [887.0, 555.0, 0.28716394305229187], [880.0, 547.0, 0.23058128356933594], [834.0, 549.0, 0.8191089034080505], [929.0, 597.0, 0.7750983238220215], [921.0, 602.0, 0.7987850904464722], [873.0, 584.0, 0.8941373825073242]]]
